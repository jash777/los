{
    "info": {
        "name": "Loan Management System - Complete API Collection",
        "description": "Comprehensive API collection for 7-stage loan origination system with automated and manual phases",
        "version": "2.0.0",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "bearer",
        "bearer": [
            {
                "key": "token",
                "value": "{{auth_token}}",
                "type": "string"
            }
        ]
    },
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3000",
            "type": "string"
        },
        {
            "key": "auth_token",
            "value": "",
            "type": "string"
        },
        {
            "key": "employee_id",
            "value": "emp_001",
            "type": "string"
        }
    ],
    "item": [
        {
            "name": "Authentication",
            "item": [
                {
                    "name": "Admin Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    const response = pm.response.json();",
                                    "    pm.collectionVariables.set('auth_token', response.token);",
                                    "    pm.test('Login successful', () => {",
                                    "        pm.expect(response.success).to.be.true;",
                                    "        pm.expect(response.token).to.exist;",
                                    "    });",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "login"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 1 - Pre-qualification",
            "item": [
                {
                    "name": "Process Pre-qualification",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Pre-qualification processed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Capture the correct applicationId from the response",
                                    "    if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('prequalification_id', response.data.applicationId);",
                                    "        console.log('Pre-qualification ID captured:', response.data.applicationId);",
                                    "    }",
                                    "    // Also capture requestId for reference",
                                    "    if (response.requestId) {",
                                    "        pm.collectionVariables.set('prequalification_request_id', response.requestId);",
                                    "        console.log('Request ID captured:', response.requestId);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"personal_info\": {\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"date_of_birth\": \"1990-05-15\",\n    \"mobile\": \"9876543210\",\n    \"email\": \"john.doe@example.com\",\n    \"pan_number\": \"ABCDE1234F\",\n    \"aadhar_number\": \"123456789012\"\n  },\n  \"address_info\": {\n    \"current_address\": {\n      \"address_line_1\": \"123 Main Street\",\n      \"city\": \"Mumbai\",\n      \"state\": \"Maharashtra\",\n      \"pincode\": \"400001\"\n    }\n  },\n  \"employment_details\": {\n    \"employment_type\": \"salaried\",\n    \"company_name\": \"Tech Corp India\",\n    \"monthly_income\": 75000,\n    \"work_experience\": 5\n  },\n  \"loan_request\": {\n    \"loan_type\": \"personal\",\n    \"requested_amount\": 500000,\n    \"loan_purpose\": \"Home renovation and furniture purchase\",\n    \"preferred_tenure\": 36\n  }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/pre-qualification/process",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "pre-qualification",
                                "process"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Pre-qualification Status",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/pre-qualification/status/{{prequalification_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "pre-qualification",
                                "status",
                                "{{prequalification_id}}"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 2 - Loan Application",
            "item": [
                {
                    "name": "Process Loan Application",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Loan application processed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Try both possible field names for applicationId",
                                    "    if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('loan_application_id', response.data.applicationId);",
                                    "        console.log('Loan Application ID captured:', response.data.applicationId);",
                                    "    } else if (response.data && response.data.application_id) {",
                                    "        pm.collectionVariables.set('loan_application_id', response.data.application_id);",
                                    "        console.log('Loan Application ID captured:', response.data.application_id);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"pre_qualification_id\": \"{{prequalification_id}}\",\n  \"loan_details\": {\n    \"loan_type\": \"personal\",\n    \"requested_amount\": 500000,\n    \"tenure\": 36,\n    \"loan_purpose\": \"Home renovation and furniture purchase\"\n  },\n  \"financial_details\": {\n    \"monthly_income\": 75000,\n    \"monthly_expenses\": 25000,\n    \"existing_emis\": 15000,\n    \"bank_balance\": 150000,\n    \"assets\": [\n      {\n        \"type\": \"property\",\n        \"description\": \"Residential apartment\",\n        \"value\": 2500000\n      }\n    ],\n    \"liabilities\": [\n      {\n        \"type\": \"loan\",\n        \"description\": \"Home loan\",\n        \"amount\": 1200000\n      }\n    ]\n  },\n  \"employment_details\": {\n    \"employment_type\": \"salaried\",\n    \"company_name\": \"Tech Corp India\",\n    \"designation\": \"Senior Software Engineer\",\n    \"work_experience\": 5,\n    \"current_job_experience\": 2\n  },\n  \"documents\": [\n    {\n      \"type\": \"income_proof\",\n      \"filename\": \"salary_slip.pdf\"\n    },\n    {\n      \"type\": \"bank_statements\",\n      \"filename\": \"bank_statement_6months.pdf\"\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/loan-application/process",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "loan-application",
                                "process"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 3 - Application Processing",
            "item": [
                {
                    "name": "Process Application Processing",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Application processing completed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Try both possible field names",
                                    "    if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('application_processing_id', response.data.applicationId);",
                                    "        console.log('Application Processing ID captured:', response.data.applicationId);",
                                    "    } else if (response.data && response.data.application_id) {",
                                    "        pm.collectionVariables.set('application_processing_id', response.data.application_id);",
                                    "        console.log('Application Processing ID captured:', response.data.application_id);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"loan_application_id\": \"{{loan_application_id}}\",\n  \"applicant_data\": {\n    \"additional_documents\": [\n      {\n        \"type\": \"employment\",\n        \"name\": \"Employment Certificate\",\n        \"url\": \"https://example.com/docs/employment_cert.pdf\"\n      }\n    ],\n    \"verification_preferences\": {\n      \"identity_method\": \"automatic\",\n      \"employment_method\": \"hybrid\",\n      \"financial_method\": \"automatic\"\n    }\n  },\n  \"verification_requests\": [\n    {\n      \"type\": \"employment\",\n      \"priority\": \"high\",\n      \"details\": \"Verify current employment status and salary\"\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/application-processing/process",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "application-processing",
                                "process"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 4 - Underwriting",
            "item": [
                {
                    "name": "Process Underwriting",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Underwriting processed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Try multiple possible field names",
                                    "    if (response.data && response.data.underwritingId) {",
                                    "        pm.collectionVariables.set('underwriting_id', response.data.underwritingId);",
                                    "        console.log('Underwriting ID captured:', response.data.underwritingId);",
                                    "    } else if (response.data && response.data.underwriting_id) {",
                                    "        pm.collectionVariables.set('underwriting_id', response.data.underwriting_id);",
                                    "        console.log('Underwriting ID captured:', response.data.underwriting_id);",
                                    "    } else if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('underwriting_id', response.data.applicationId);",
                                    "        console.log('Underwriting ID captured from applicationId:', response.data.applicationId);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"credit_bureau_preference\": \"CIBIL\",\n  \"collateral_details\": {\n    \"type\": \"property\",\n    \"estimated_value\": 2500000,\n    \"ownership_proof\": \"Property registration documents\",\n    \"valuation_certificate\": \"Approved valuer certificate\"\n  },\n  \"additional_income_sources\": [\n    {\n      \"source_type\": \"rental\",\n      \"monthly_amount\": 10000,\n      \"proof_document\": \"Rental agreement and receipts\"\n    }\n  ],\n  \"risk_mitigation_factors\": [\n    \"existing_customer\",\n    \"salary_account_holder\",\n    \"property_ownership\"\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/underwriting/process/{{application_processing_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "underwriting",
                                "process",
                                "{{application_processing_id}}"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 5 - Credit Decision",
            "item": [
                {
                    "name": "Process Credit Decision",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Credit decision processed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Try multiple possible field names",
                                    "    if (response.data && response.data.creditDecisionId) {",
                                    "        pm.collectionVariables.set('credit_decision_id', response.data.creditDecisionId);",
                                    "        console.log('Credit Decision ID captured:', response.data.creditDecisionId);",
                                    "    } else if (response.data && response.data.credit_decision_id) {",
                                    "        pm.collectionVariables.set('credit_decision_id', response.data.credit_decision_id);",
                                    "        console.log('Credit Decision ID captured:', response.data.credit_decision_id);",
                                    "    } else if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('credit_decision_id', response.data.applicationId);",
                                    "        console.log('Credit Decision ID captured from applicationId:', response.data.applicationId);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"manual_review_required\": false,\n  \"reviewer_notes\": \"Application meets all automated criteria\",\n  \"additional_conditions\": [\n    \"Maintain minimum balance of â‚¹50,000\",\n    \"Submit annual income proof\"\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/credit-decision/process/{{underwriting_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "credit-decision",
                                "process",
                                "{{underwriting_id}}"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 6 - Quality Check",
            "item": [
                {
                    "name": "Process Quality Check",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Quality check processed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Try multiple possible field names",
                                    "    if (response.data && response.data.qualityCheckId) {",
                                    "        pm.collectionVariables.set('quality_check_id', response.data.qualityCheckId);",
                                    "        console.log('Quality Check ID captured:', response.data.qualityCheckId);",
                                    "    } else if (response.data && response.data.quality_check_id) {",
                                    "        pm.collectionVariables.set('quality_check_id', response.data.quality_check_id);",
                                    "        console.log('Quality Check ID captured:', response.data.quality_check_id);",
                                    "    } else if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('quality_check_id', response.data.applicationId);",
                                    "        console.log('Quality Check ID captured from applicationId:', response.data.applicationId);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"priority_level\": \"standard\",\n  \"manual_review_required\": false,\n  \"reviewer_notes\": \"Standard quality check for approved application\",\n  \"additional_checks\": [\n    {\n      \"type\": \"compliance\",\n      \"name\": \"KYC Compliance Check\",\n      \"parameters\": {\n        \"check_aml\": true,\n        \"verify_sanctions\": true\n      }\n    },\n    {\n      \"type\": \"document\",\n      \"name\": \"Document Completeness\",\n      \"parameters\": {\n        \"verify_signatures\": true,\n        \"check_validity\": true\n      }\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/quality-check/process/{{credit_decision_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "quality-check",
                                "process",
                                "{{credit_decision_id}}"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Quality Check Report",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/quality-check/report/{{quality_check_id}}?format=json",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "quality-check",
                                "report",
                                "{{quality_check_id}}"
                            ],
                            "query": [
                                {
                                    "key": "format",
                                    "value": "json"
                                }
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Stage 7 - Loan Funding (Manual Phase)",
            "item": [
                {
                    "name": "Process Loan Funding",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Loan funding processed successfully', () => {",
                                    "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                                    "    const response = pm.response.json();",
                                    "    pm.expect(response.success).to.be.true;",
                                    "    // Try multiple possible field names",
                                    "    if (response.data && response.data.loanFundingId) {",
                                    "        pm.collectionVariables.set('loan_funding_id', response.data.loanFundingId);",
                                    "        console.log('Loan Funding ID captured:', response.data.loanFundingId);",
                                    "    } else if (response.data && response.data.loan_funding_id) {",
                                    "        pm.collectionVariables.set('loan_funding_id', response.data.loan_funding_id);",
                                    "        console.log('Loan Funding ID captured:', response.data.loan_funding_id);",
                                    "    } else if (response.data && response.data.applicationId) {",
                                    "        pm.collectionVariables.set('loan_funding_id', response.data.applicationId);",
                                    "        console.log('Loan Funding ID captured from applicationId:', response.data.applicationId);",
                                    "    }",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "x-employee-id",
                                "value": "{{employee_id}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"disbursement_method\": \"bank_transfer\",\n  \"disbursement_priority\": \"standard\",\n  \"special_instructions\": \"Verify beneficiary account before disbursement\",\n  \"beneficiary_verification_required\": true,\n  \"third_party_disbursement\": false,\n  \"disbursement_schedule\": \"next_business_day\",\n  \"processing_fee_waiver\": false,\n  \"insurance_opt_out\": false,\n  \"custom_account_details\": {\n    \"account_number\": \"1234567890123456\",\n    \"ifsc_code\": \"HDFC0000123\",\n    \"account_holder_name\": \"John Doe\",\n    \"bank_name\": \"HDFC Bank\"\n  },\n  \"notification_preferences\": {\n    \"sms\": true,\n    \"email\": true,\n    \"push\": false\n  }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/loan-funding/process/{{quality_check_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "loan-funding",
                                "process",
                                "{{quality_check_id}}"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Loan Funding Status",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/loan-funding/status/{{loan_funding_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "loan-funding",
                                "status",
                                "{{loan_funding_id}}"
                            ]
                        }
                    }
                },
                {
                    "name": "Generate Funding Report",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/loan-funding/report/{{loan_funding_id}}?format=pdf",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "loan-funding",
                                "report",
                                "{{loan_funding_id}}"
                            ],
                            "query": [
                                {
                                    "key": "format",
                                    "value": "pdf"
                                }
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "System Health & Monitoring",
            "item": [
                {
                    "name": "System Health Check",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/health",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "health"
                            ]
                        }
                    }
                },
                {
                    "name": "All Phases Overview",
                    "request": {
                        "method": "GET",
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                ""
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "Test Scenarios",
            "item": [
                {
                    "name": "High-Value Loan Application",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"personal_info\": {\n    \"first_name\": \"Rajesh\",\n    \"last_name\": \"Kumar\",\n    \"date_of_birth\": \"1980-03-10\",\n    \"mobile\": \"9876543212\",\n    \"email\": \"rajesh.kumar@example.com\",\n    \"pan_number\": \"KLMNO9876P\",\n    \"aadhar_number\": \"456789123456\"\n  },\n  \"address_info\": {\n    \"current_address\": {\n      \"address_line_1\": \"456 Business District\",\n      \"city\": \"Bangalore\",\n      \"state\": \"Karnataka\",\n      \"pincode\": \"560001\"\n    }\n  },\n  \"employment_details\": {\n    \"employment_type\": \"salaried\",\n    \"company_name\": \"Global Tech Solutions\",\n    \"monthly_income\": 250000,\n    \"work_experience\": 12\n  },\n  \"loan_request\": {\n    \"loan_type\": \"home\",\n    \"requested_amount\": 5000000,\n    \"loan_purpose\": \"Purchase of luxury residential property\",\n    \"preferred_tenure\": 240\n  }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/loan-origination/pre-qualification/process",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "loan-origination",
                                "pre-qualification",
                                "process"
                            ]
                        }
                    }
                }
            ]
        }
    ]
}